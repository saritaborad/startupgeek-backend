{
    "sourceFile": "controller/userPlan.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 23,
            "patches": [
                {
                    "date": 1673263531055,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1673264408454,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,9 @@\n       Userdata.save();\r\n     }\r\n   }\r\n   else{\r\n-    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,stateName:req.body.stateName,service_type:req.body.service_type},obj,{new:true});\r\n+    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId},obj,{new:true});\r\n   }\r\n   \r\n   giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n });\r\n"
                },
                {
                    "date": 1673264481061,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,9 @@\n     stateName: req.body.stateName,\r\n   };\r\n \r\n   var Userdata = await UserPlan.findOne({userid:req.uId,stateName:req.body.stateName,service_type:req.body.service_type});\r\n-  if(Userdata.length == 0){\r\n+  if(!Userdata){\r\n     var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n"
                },
                {
                    "date": 1673264636306,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,9 @@\n       Userdata.save();\r\n     }\r\n   }\r\n   else{\r\n-    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId},obj,{new:true});\r\n+    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,stateName:req.body.stateName,service_type:req.body.service_type},obj,{new:true});\r\n   }\r\n   \r\n   giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n });\r\n"
                },
                {
                    "date": 1673264704748,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,9 @@\n       Userdata.save();\r\n     }\r\n   }\r\n   else{\r\n-    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,stateName:req.body.stateName,service_type:req.body.service_type},obj,{new:true});\r\n+    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId},obj,{new:true});\r\n   }\r\n   \r\n   giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n });\r\n"
                },
                {
                    "date": 1673265064692,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,15 +17,15 @@\n     stateId: req.body._id,\r\n     stateName: req.body.stateName,\r\n   };\r\n \r\n-  var Userdata = await UserPlan.findOne({userid:req.uId,stateName:req.body.stateName,service_type:req.body.service_type});\r\n+  var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n   if(!Userdata){\r\n     var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n-    }\r\n+    } \r\n   }\r\n   else{\r\n     var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId},obj,{new:true});\r\n   }\r\n"
                },
                {
                    "date": 1673265073095,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,9 @@\n       Userdata.save();\r\n     } \r\n   }\r\n   else{\r\n-    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId},obj,{new:true});\r\n+    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanIdd},obj,{new:true});\r\n   }\r\n   \r\n   giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n });\r\n"
                },
                {
                    "date": 1673265171681,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,17 +18,17 @@\n     stateName: req.body.stateName,\r\n   };\r\n \r\n   var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n-  if(!Userdata){\r\n+  if(!(req.body.userplanId == Userdata._id)){\r\n     var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n     } \r\n   }\r\n   else{\r\n-    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanIdd},obj,{new:true});\r\n+    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n   }\r\n   \r\n   giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n });\r\n"
                },
                {
                    "date": 1673265261400,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,18 +17,18 @@\n     stateId: req.body._id,\r\n     stateName: req.body.stateName,\r\n   };\r\n \r\n-  var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n-  if(!(req.body.userplanId == Userdata._id)){\r\n+  // var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n+  // if(!(req.body.userplanId == Userdata._id)){\r\n     var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n     } \r\n-  }\r\n-  else{\r\n-    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n-  }\r\n+  // }\r\n+  // else{\r\n+  //   var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n+  // }\r\n   \r\n   giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n });\r\n"
                },
                {
                    "date": 1673265326462,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,18 +17,18 @@\n     stateId: req.body._id,\r\n     stateName: req.body.stateName,\r\n   };\r\n \r\n-  // var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n-  // if(!(req.body.userplanId == Userdata._id)){\r\n+  var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n+  if(!(req.body.userplanId == Userdata._id)){\r\n     var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n     } \r\n-  // }\r\n-  // else{\r\n-  //   var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n-  // }\r\n+  }\r\n+  else{\r\n+    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n+  }\r\n   \r\n   giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n });\r\n"
                },
                {
                    "date": 1673342245054,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,9 @@\n     stateName: req.body.stateName,\r\n   };\r\n \r\n   var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n-  if(!(req.body.userplanId == Userdata._id)){\r\n+  if((!(req.body.userplanId == Userdata._id)) || (req.body.userplanId == \"\")){\r\n     var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n"
                },
                {
                    "date": 1673342323672,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,9 @@\n     stateName: req.body.stateName,\r\n   };\r\n \r\n   var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n-  if((!(req.body.userplanId == Userdata._id)) || (req.body.userplanId == \"\")){\r\n+  if((!(req.body.userplanId == Userdata._id)) || (req.body.userplanId == \"\" && !Userdata)){\r\n     var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n"
                },
                {
                    "date": 1673342401585,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,15 +18,22 @@\n     stateName: req.body.stateName,\r\n   };\r\n \r\n   var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n-  if((!(req.body.userplanId == Userdata._id)) || (req.body.userplanId == \"\" && !Userdata)){\r\n+  if((!(req.body.userplanId == Userdata._id))){\r\n     var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n     } \r\n   }\r\n+  else if(req.body.userplanId == \"\"){\r\n+    var Userdata = await UserPlan.create(obj);\r\n+    if (Userdata.total == null) {\r\n+      Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n+      Userdata.save();\r\n+    } \r\n+  }\r\n   else{\r\n     var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n   }\r\n   \r\n"
                },
                {
                    "date": 1673342416621,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,22 +20,20 @@\n \r\n   var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n   if((!(req.body.userplanId == Userdata._id))){\r\n     var Userdata = await UserPlan.create(obj);\r\n-    if (Userdata.total == null) {\r\n-      Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n-      Userdata.save();\r\n-    } \r\n   }\r\n   else if(req.body.userplanId == \"\"){\r\n     var Userdata = await UserPlan.create(obj);\r\n+  }\r\n+  else{\r\n+    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n+  }\r\n+\r\n+  var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n     } \r\n-  }\r\n-  else{\r\n-    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n-  }\r\n   \r\n   giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n });\r\n"
                },
                {
                    "date": 1673342468228,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,20 +17,21 @@\n     stateId: req.body._id,\r\n     stateName: req.body.stateName,\r\n   };\r\n \r\n-  var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n-  if((!(req.body.userplanId == Userdata._id))){\r\n-    var Userdata = await UserPlan.create(obj);\r\n+  if(req.body.userplanId != \"\"){\r\n+    var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n+    if((!(req.body.userplanId == Userdata._id))){\r\n+      var Userdata = await UserPlan.create(obj);\r\n+    }\r\n   }\r\n   else if(req.body.userplanId == \"\"){\r\n     var Userdata = await UserPlan.create(obj);\r\n   }\r\n   else{\r\n     var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n   }\r\n \r\n-  var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n     } \r\n"
                },
                {
                    "date": 1673342543636,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,13 +28,14 @@\n     var Userdata = await UserPlan.create(obj);\r\n   }\r\n   else{\r\n     var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n+    return giveresponse(res, 200, true, \"plan updated\", Userdata);\r\n   }\r\n \r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n     } \r\n   \r\n-  giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n+  return giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n });\r\n"
                },
                {
                    "date": 1673342684913,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,11 +22,13 @@\n     var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n     if((!(req.body.userplanId == Userdata._id))){\r\n       var Userdata = await UserPlan.create(obj);\r\n     }\r\n+    return giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n   }\r\n   else if(req.body.userplanId == \"\"){\r\n     var Userdata = await UserPlan.create(obj);\r\n+    return giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n   }\r\n   else{\r\n     var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n     return giveresponse(res, 200, true, \"plan updated\", Userdata);\r\n@@ -36,6 +38,5 @@\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n     } \r\n   \r\n-  return giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n });\r\n"
                },
                {
                    "date": 1673342701730,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,22 +21,26 @@\n   if(req.body.userplanId != \"\"){\r\n     var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n     if((!(req.body.userplanId == Userdata._id))){\r\n       var Userdata = await UserPlan.create(obj);\r\n+      if (Userdata.total == null) {\r\n+        Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n+        Userdata.save();\r\n+      } \r\n     }\r\n     return giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n   }\r\n   else if(req.body.userplanId == \"\"){\r\n     var Userdata = await UserPlan.create(obj);\r\n+    if (Userdata.total == null) {\r\n+      Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n+      Userdata.save();\r\n+    } \r\n     return giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n   }\r\n   else{\r\n     var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n     return giveresponse(res, 200, true, \"plan updated\", Userdata);\r\n   }\r\n \r\n-    if (Userdata.total == null) {\r\n-      Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n-      Userdata.save();\r\n-    } \r\n   \r\n });\r\n"
                },
                {
                    "date": 1673342715602,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,8 +37,9 @@\n     } \r\n     return giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n   }\r\n   else{\r\n+    console.log(1)\r\n     var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n     return giveresponse(res, 200, true, \"plan updated\", Userdata);\r\n   }\r\n \r\n"
                },
                {
                    "date": 1673342759354,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,31 +17,18 @@\n     stateId: req.body._id,\r\n     stateName: req.body.stateName,\r\n   };\r\n \r\n-  if(req.body.userplanId != \"\"){\r\n-    var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n-    if((!(req.body.userplanId == Userdata._id))){\r\n-      var Userdata = await UserPlan.create(obj);\r\n-      if (Userdata.total == null) {\r\n-        Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n-        Userdata.save();\r\n-      } \r\n-    }\r\n-    return giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n-  }\r\n-  else if(req.body.userplanId == \"\"){\r\n+  var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n+  if(!(req.body.userplanId == Userdata._id)){\r\n     var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n     } \r\n-    return giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n   }\r\n   else{\r\n-    console.log(1)\r\n     var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n-    return giveresponse(res, 200, true, \"plan updated\", Userdata);\r\n   }\r\n-\r\n   \r\n+  giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n });\r\n"
                },
                {
                    "date": 1673352135521,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n   const planData = await PricingPlan.findOne({ _id: req.body._id, \"plan._id\": { $eq: req.body.planid } }, { \"plan.$\": 1 });\r\n   const obj = {\r\n     userid: req.uId,\r\n     plan: planData.plan,\r\n-    planid: req.body.planid,\r\n+    planid: req.body._id,\r\n     service_type: req.body.service_type,\r\n     service_price: req.body.service_price,\r\n     service_duration: req.body.service_duration,\r\n     company_type: req.body.company_type,\r\n"
                },
                {
                    "date": 1673951376803,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,27 +8,45 @@\n   const planData = await PricingPlan.findOne({ _id: req.body._id, \"plan._id\": { $eq: req.body.planid } }, { \"plan.$\": 1 });\r\n   const obj = {\r\n     userid: req.uId,\r\n     plan: planData.plan,\r\n-    planid: req.body._id,\r\n+    planid: req.body.planid,\r\n     service_type: req.body.service_type,\r\n     service_price: req.body.service_price,\r\n     service_duration: req.body.service_duration,\r\n     company_type: req.body.company_type,\r\n-    stateId: req.body._id,\r\n+    stateId: planData.stateId,\r\n     stateName: req.body.stateName,\r\n   };\r\n \r\n-  var Userdata = await UserPlan.findOne({userid:req.uId,_id:req.body.userplanId});\r\n-  if(!(req.body.userplanId == Userdata._id)){\r\n+  if(req.body.userplanId == \"\"){\r\n     var Userdata = await UserPlan.create(obj);\r\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n     } \r\n-  }\r\n-  else{\r\n+  } else{\r\n     var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n   }\r\n-  \r\n   giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n+\r\n+  // if(!(req.body?.userplanId == Userdata?._id)){\r\n+  //   var Userdata = await UserPlan.create(obj);\r\n+  //   if (Userdata.total == null) {\r\n+  //     Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n+  //     Userdata.save();\r\n+  //   } \r\n+  // } else {\r\n+  //   var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n+  // }\r\n });\r\n+\r\n+// user\r\n+// get user plan\r\n+exports.getUserPlan = asynchandler(async(req,res, next) => {\r\n+  const userplan = await UserPlan.find({_id: req.body.userplanId, userid: req.uId})\r\n+  if(!userplan){\r\n+    giveresponse(res, 201, false, \"Userplan not found with this details\")\r\n+  } else {\r\n+    giveresponse(res, 200, true, \"Userplan get successfully\", userplan)\r\n+  }\r\n+})\n\\ No newline at end of file\n"
                },
                {
                    "date": 1674196836771,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,13 +9,13 @@\n   const obj = {\r\n     userid: req.uId,\r\n     plan: planData.plan,\r\n     planid: req.body.planid,\r\n-    service_type: req.body.service_type,\r\n+    entity_type: req.body.entity_type,\r\n     service_price: req.body.service_price,\r\n     service_duration: req.body.service_duration,\r\n     company_type: req.body.company_type,\r\n-    stateId: planData.stateId,\r\n+    stateId:  planData.stateId,\r\n     stateName: req.body.stateName,\r\n   };\r\n \r\n   if(req.body.userplanId == \"\"){\r\n@@ -23,9 +23,9 @@\n     if (Userdata.total == null) {\r\n       Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n       Userdata.save();\r\n     } \r\n-  } else{\r\n+  } else {\r\n     var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,_id:req.body.userplanId},obj,{new:true});\r\n   }\r\n   giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n \r\n"
                },
                {
                    "date": 1674197212350,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -12,9 +12,8 @@\n     planid: req.body.planid,\r\n     entity_type: req.body.entity_type,\r\n     service_price: req.body.service_price,\r\n     service_duration: req.body.service_duration,\r\n-    company_type: req.body.company_type,\r\n     stateId:  planData.stateId,\r\n     stateName: req.body.stateName,\r\n   };\r\n \r\n"
                }
            ],
            "date": 1673263531055,
            "name": "Commit-0",
            "content": "const { giveresponse } = require(\"../helper/res_help\");\r\nconst asynchandler = require(\"../middleware/async\");\r\nconst PricingPlan = require(\"../Model/PricingPlan\");\r\nconst UserPlan = require(\"../Model/UserPlan\");\r\n\r\n// get plan and save plan\r\nexports.addPlan = asynchandler(async (req, res) => {\r\n  const planData = await PricingPlan.findOne({ _id: req.body._id, \"plan._id\": { $eq: req.body.planid } }, { \"plan.$\": 1 });\r\n  const obj = {\r\n    userid: req.uId,\r\n    plan: planData.plan,\r\n    planid: req.body.planid,\r\n    service_type: req.body.service_type,\r\n    service_price: req.body.service_price,\r\n    service_duration: req.body.service_duration,\r\n    company_type: req.body.company_type,\r\n    stateId: req.body._id,\r\n    stateName: req.body.stateName,\r\n  };\r\n\r\n  var Userdata = await UserPlan.findOne({userid:req.uId,stateName:req.body.stateName,service_type:req.body.service_type});\r\n  if(Userdata.length == 0){\r\n    var Userdata = await UserPlan.create(obj);\r\n    if (Userdata.total == null) {\r\n      Userdata.total = Number(Userdata.plan[0].package_fee) + Number(Userdata.plan[0].state_fee);\r\n      Userdata.save();\r\n    }\r\n  }\r\n  else{\r\n    var Userdata = await UserPlan.findOneAndUpdate({userid:req.uId,stateName:req.body.stateName,service_type:req.body.service_type},obj,{new:true});\r\n  }\r\n  \r\n  giveresponse(res, 200, true, \"plan add in user\", Userdata);\r\n});\r\n"
        }
    ]
}